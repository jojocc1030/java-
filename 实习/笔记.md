



1. 作废：先做出能作废的情况
2. 合同增加6个字段
3. 核销概念：时间顺序正序填充
![[Pasted image 20240611144752.png]]


### 业务梳理
1. [x] 分页查询（模糊搜索匹配）
2. 作废处理：
	1. [x] 待梳理更清晰的业务逻辑
3. excel表格导出
	1. [ ] 测试
4. [x] 根据合同id查询对应发票list
5. 新增发票
	1. 查询合同已开票金额，比较发票申请和未开票的数额：
		1. [x] 新增采购合同字段（参考sales_contract）![[Pasted image 20240613135817.png]]
	2. 批量插入新发票（基本结构可以参考源代码）
	3. 同步数据
		1. 同步里程碑已开票金额
		2. 同步采购合同相关字段
6. 付款申请
	1. [x] 生成编号
	2. [x] 新建付款申请
		1. 插入付款申请表
		2. 根据当前状态判断是保存还是提交
			1. 保存：更新状态码
			2. 提交：做数值校验，更新状态码，更**新相关数值信息**，提交OA
			![[Pasted image 20240618111546.png]]
			*合同和里程碑金额：收票相关发票管理改，实付未付相关放在财务确认后改*
	1. [x] 更新付款申请
	2. [x] 查询付款申请
	3. [x] 删除付款申请

表设计：
	 - [x] 新建  付款申请表
	- [x] 新建 付款申请明细表（主要会涉及多个付款方式付款商）- 后续添加
	- [x] ~~新建 付款申请里程碑表~~  `finance_economics` 为里程碑表
	- [x] 更改：新增采购合同有关金额的字段
	- [x] 新增关系表字段 ： 本次核销金额
		- [x] **未更新idea中的mapper等**
	- [ ] 查看付款申请时一并查看
	- [x] 保存和提交时根据状态码执行不同的操作逻辑
	
		 ![[Pasted image 20240613135817.png]]

### 问题
1. ~~新建哪张表？~~
2. 新增（合同？？）字段
3. 登录不成功 
	![[Pasted image 20240612094935.png]]
4. ~~合同付款信息如何~~![[Pasted image 20240612155940.png]]  ---新建table：付款申请
5. 付款申请：
	1. [x] 里程碑 - 合同可以覆盖的里程碑
	2. [x] 付款申请和发票是多对多的关系
	3. [x] 建立的三元关系表是哪个---- (付款申请，发票号，客商)
	4. [x] 开票申请的代码在哪块 --- invoiceApplication
	5. [x]  该表内容之后example、xml如何重新覆盖--- 不用覆盖，直接建立关系表查询即可
	![[Pasted image 20240617110319.png]]
	购方销方分别的意思
	6. [x] 付款申请新增字段，添加预付相关字段：是否预付；预付金额；待核销金额；已核销金额
	7. [x] 修改新增付款申请接口，
	8. [x] 新建后关联发票接口，
	10. [x] 财务权限确认
		1. 字段关系： 总金额 = 实付 + 未付
		2. 预付：付款申请已有字段，直接查询，确认付款时更新
		3. 总金额 = 已收票 + 未收票 （新增发票时更新）
		4. 应付：新增发票时更新，*付款申请关联发票时更新*
	11. [x] 付款申请-预付分页查询：![[Pasted image 20240620095854.png]]
	12. [x] 根据采购合同id查询付款申请（包含预付和已关联发票部分）
	13. [x] transaction注解检查
	14. [ ] 文档
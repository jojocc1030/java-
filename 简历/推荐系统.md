https://www.zhihu.com/tardis/zm/art/621058981?source_id=1003

## 17.1 推荐系统web服务的构成

![[Pasted image 20240321013017.png]]
上图中的绿色虚线框中的数据交互能力就是推荐web服务的范畴，它是前端(也叫终端)与后端的互动。企业级推荐系统web服务主要分成2个部分：
-  一个是推荐Restful API接口服务（下面统一简称为**推荐系统接口服务**，不再特别说明）；
- 一个是**推荐系统推断服务**

## 17.2 推荐系统接口服务

为了给前端提供个性化推荐服务，图1中的推荐Restful API接口服务模块需要完成3件事情。首先需要获得该用户的推荐列表(直接获得已经计算好的推荐列表，这就是17.3.2节要讲的，或者通过临时计算获得推荐列表，这就是第17.3.3节要讲的)，其次是将推荐列表组装成前端最终需要的数据结构(第一步获得的推荐列表一般是物品id的列表，实际展示给前端还需要物品的各种metadata信息，如标题、海报图、评分、价格等等，这些信息的组装就是在这一步完成的，这些信息一般会存放到关系型数据库中，或者采用json的形式存放到Redis、文档型NoSQL中，所以这里至少还有一次额外的数据库访问)及一些业务上的处理（下面会介绍），最后是响应前端的HTTP请求(一般是GET或者POST请求)，将最终推荐结果返回给前端（一般是JSON结构，下面图图3就是一个参考案例）。

**推荐接口服务模块**一般是用Java来实现的（比如利用Tomcat、Spring系列等Java web服务框架），这主要是因为目前大部分公司的后端服务是基于Java生态系统来搭建的。Java生态系统非常完备和成熟，采用Java开发可以更好地将推荐服务整合到所有后端服务中（毕竟任何一个产品，除了推荐系统外，还有非常多的其他服务，比如淘宝的客户管理、库存管理、商家管理、购买下单等）。推荐系统推断服务一般是用Python来实现的（比如Flask、FastAPI等或者TensorFlow、PyTorch深度学习框架提供的推断服务框架），这主要是因为目前机器学习的主流编程语言是Python，用Python更加方便。**推荐接口服务与推荐推断服务之间的交互是通过HTTP请求的方式来实现的。**

## 推荐系统推断服务


该模式最大的特点是事先将每个用户的推荐列表计算出来，存到数据库中。一般可以采用Redis等NoSQL数据库，采用key-value的方式存储，key就是用户id，value就是给用户的推荐列表。如果是用Redis存，value的数据结构可以使Sorted Sets，这种数据结构比较适合推荐系统，Sorted Sets中的element可以是推荐的物品id，score是物品的预测评分或者预测概率值等，还可以根据Sorted Sets中的score进行分页筛选等操作。


## 限流场景设计
![[Pasted image 20240321023827.png]]
eg. 手机验证码5分钟内不能超过多少次将进行限流
使用**zset**